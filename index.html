<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conjoncture MINPMEESA - Système d'Information</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .hidden-section { display: none; }
        .active-tab { border-bottom: 3px solid #10b981; color: #10b981; }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-x-hidden">

    <!-- 1ère INTERFACE : AUTHENTIFICATION -->
    <div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-900 p-4">
        <div class="absolute inset-0 opacity-10 flex items-center justify-center pointer-events-none">
            <h1 class="text-[12vw] font-black uppercase select-none text-white text-center leading-none">CONJONCTURE<br>MINPMEESA</h1>
        </div>
        
        <div class="relative bg-white p-8 md:p-12 rounded-[2.5rem] shadow-2xl w-full max-w-4xl flex flex-col items-center">
            <!-- Logo & Titre -->
            <div class="flex flex-col items-center mb-10 text-center">
                <div class="w-20 h-20 bg-white rounded-full flex items-center justify-center mb-4 border-4 border-emerald-500 shadow-lg overflow-hidden p-1">
                   <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Coat_of_arms_of_Cameroon.svg/600px-Coat_of_arms_of_Cameroon.svg.png" alt="Logo Ministère" class="object-contain h-full">
                </div>
                <h1 class="text-3xl font-black text-slate-800 tracking-tight">CONJONCTURE MINPMEESA</h1>
                <p class="text-slate-500 font-medium">Système d'Information Statistique Intégré</p>
                
                <div class="flex gap-2 mt-6 bg-slate-100 p-1 rounded-full text-[10px] font-black tracking-widest">
                    <button class="bg-white px-5 py-2 rounded-full shadow-sm text-emerald-600">FRANÇAIS</button>
                    <button class="px-5 py-2 rounded-full hover:bg-white transition text-slate-400">ENGLISH</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                <!-- Admin 1 -->
                <button onclick="requestAccess('admin1')" class="group p-8 border-2 border-slate-100 rounded-3xl hover:border-emerald-500 hover:shadow-xl transition-all flex flex-col items-center text-center">
                    <div class="w-14 h-14 bg-red-50 text-red-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition border border-red-100">
                        <i data-lucide="shield-check" class="w-8 h-8"></i>
                    </div>
                    <span class="font-bold text-slate-700">Services Centraux</span>
                    <span class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">(ADMIN 1)</span>
                </button>
                <!-- Admin 2 -->
                <button onclick="requestAccess('admin2')" class="group p-8 border-2 border-slate-100 rounded-3xl hover:border-emerald-500 hover:shadow-xl transition-all flex flex-col items-center text-center">
                    <div class="w-14 h-14 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition border border-blue-100">
                        <i data-lucide="map-pin" class="w-8 h-8"></i>
                    </div>
                    <span class="font-bold text-slate-700">Services Déconcentrés</span>
                    <span class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">(ADMIN 2)</span>
                </button>
                <!-- Visiteur -->
                <button onclick="login('visiteur')" class="group p-8 border-2 border-slate-100 rounded-3xl hover:border-emerald-500 hover:shadow-xl transition-all flex flex-col items-center text-center">
                    <div class="w-14 h-14 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition border border-emerald-100">
                        <i data-lucide="users" class="w-8 h-8"></i>
                    </div>
                    <span class="font-bold text-slate-700">Visiteur Public</span>
                    <span class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">(ACCÈS LIBRE)</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DE CODE D'ACCÈS -->
    <div id="login-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/80 backdrop-blur-sm hidden-section p-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl w-full max-w-sm text-center">
            <div class="w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mx-auto mb-6 text-slate-400">
                <i data-lucide="lock" class="w-8 h-8"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">Code d'accès requis</h3>
            <p id="modal-role-text" class="text-sm text-slate-400 mb-6 uppercase font-bold tracking-widest"></p>
            
            <input type="password" id="access-code" placeholder="Entrez le code (ex: 2026)" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl mb-4 text-center text-2xl font-black tracking-[0.5em] focus:border-emerald-500 outline-none transition">
            
            <div id="error-msg" class="text-red-500 text-xs font-bold mb-4 hidden-section">Code incorrect. Veuillez réessayer.</div>

            <div class="flex gap-2">
                <button onclick="closeModal()" class="flex-1 py-3 font-bold text-slate-400 hover:text-slate-600">Annuler</button>
                <button onclick="verifyCode()" class="flex-1 bg-slate-900 text-white py-3 rounded-2xl font-bold hover:bg-slate-800">Valider</button>
            </div>
        </div>
    </div>

    <!-- 2ème INTERFACE : CONTENU PRINCIPAL -->
    <div id="app-screen" class="hidden-section flex flex-col min-h-screen">
        <!-- HEADER -->
        <header class="bg-emerald-700 text-white px-8 py-6 sticky top-0 z-40 shadow-xl overflow-hidden">
            <div class="absolute right-0 top-0 opacity-10 pointer-events-none transform translate-x-1/4 -translate-y-1/4">
                <i data-lucide="trending-up" class="w-64 h-64"></i>
            </div>
            
            <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-6 relative z-10">
                <div class="flex items-center gap-6">
                    <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center p-2 shadow-inner">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Coat_of_arms_of_Cameroon.svg/600px-Coat_of_arms_of_Cameroon.svg.png" class="h-full object-contain" alt="Logo">
                    </div>
                    <div>
                        <h2 class="text-2xl font-black tracking-tighter uppercase leading-none">Tableau de Bord Statistique PMEESA</h2>
                        <p class="text-[10px] font-bold uppercase tracking-[0.2em] opacity-80 mt-1">Modernisation du Système d'Information - République du Cameroun</p>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <div id="role-badge" class="px-4 py-2 rounded-xl text-[10px] font-black uppercase bg-white/20 backdrop-blur border border-white/20"></div>
                    <button onclick="logout()" class="p-3 bg-white/10 hover:bg-white/20 rounded-xl transition shadow-sm"><i data-lucide="log-out" class="w-5 h-5"></i></button>
                </div>
            </div>
        </header>

        <!-- NAVIGATION -->
        <div class="bg-white border-b sticky top-[104px] z-30 shadow-sm">
            <div class="max-w-7xl mx-auto px-8">
                <nav class="flex gap-10 font-black text-xs text-slate-400 uppercase tracking-widest overflow-x-auto whitespace-nowrap scrollbar-hide">
                    <button onclick="navigate('bdd')" id="nav-bdd" class="py-5 hover:text-emerald-600 transition border-b-2 border-transparent">Base de Données</button>
                    <button onclick="navigate('questionnaires')" id="nav-questionnaires" class="py-5 hover:text-emerald-600 transition border-b-2 border-transparent">Questionnaires</button>
                    <button onclick="navigate('dashboard')" id="nav-dashboard" class="py-5 hover:text-emerald-600 transition border-b-2 border-transparent">Tableau de Bord</button>
                </nav>
            </div>
        </div>

        <main class="flex-1 p-4 md:p-8 bg-slate-50">
            <div class="max-w-7xl mx-auto">
                
                <!-- PAGE : BASE DE DONNÉES -->
                <div id="page-bdd" class="hidden-section space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                        <!-- Filtres -->
                        <div class="lg:col-span-1 bg-white p-6 rounded-3xl shadow-sm border border-slate-100 space-y-6">
                            <h3 class="font-bold flex items-center gap-2"><i data-lucide="filter" class="w-4 h-4 text-emerald-600"></i> Filtres</h3>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Année(s)</label>
                                    <select multiple class="w-full mt-2 p-3 bg-slate-50 border-none rounded-2xl text-xs h-32 focus:ring-2 ring-emerald-500">
                                        <option value="2021">2021</option>
                                        <option value="2022">2022</option>
                                        <option value="2023">2023</option>
                                        <option value="2024">2024</option>
                                        <option value="2025">2025 (Archives)</option>
                                        <option value="2026" selected>2026 (Nouveau)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Région(s)</label>
                                    <select multiple class="w-full mt-2 p-3 bg-slate-50 border-none rounded-2xl text-xs h-32">
                                        <option selected>Toutes les régions</option>
                                        <option>Centre</option>
                                        <option>Littoral</option>
                                        <option>Ouest</option>
                                        <option>Nord</option>
                                    </select>
                                </div>
                            </div>
                            <button class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest flex items-center justify-center gap-2">
                                <i data-lucide="download" class="w-4 h-4"></i> Télécharger la sélection
                            </button>
                        </div>

                        <!-- Contenu -->
                        <div class="lg:col-span-3 space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="bg-white p-6 rounded-3xl border-2 border-amber-100 hover:border-amber-300 transition group cursor-pointer">
                                    <div class="w-12 h-12 bg-amber-50 text-amber-600 rounded-xl flex items-center justify-center mb-4"><i data-lucide="archive"></i></div>
                                    <h4 class="font-bold">Archives Pré-2026</h4>
                                    <p class="text-xs text-slate-400">Ancienne forme structurelle des bases (2021-2025).</p>
                                </div>
                                <div class="bg-white p-6 rounded-3xl border-2 border-emerald-100 hover:border-emerald-300 transition group cursor-pointer">
                                    <div class="w-12 h-12 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center mb-4"><i data-lucide="database"></i></div>
                                    <h4 class="font-bold">Nouvelle Formulation (2026+)</h4>
                                    <p class="text-xs text-slate-400">Bases brutes validées et exploitables directement.</p>
                                </div>
                            </div>

                            <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
                                <div class="p-6 border-b flex justify-between items-center">
                                    <h4 class="font-bold flex items-center gap-2"><i data-lucide="eye" class="w-4 h-4 text-emerald-600"></i> Visualisation de la base</h4>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left text-xs">
                                        <thead class="bg-slate-50 text-slate-400 font-black uppercase tracking-widest">
                                            <tr>
                                                <th class="p-5">Code Base</th>
                                                <th class="p-5">Période</th>
                                                <th class="p-5">Statut</th>
                                                <th class="p-5 text-right">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y">
                                            <tr>
                                                <td class="p-5 font-black">BDD-T1-2026</td>
                                                <td class="p-5 font-bold">Trimestre 1 - 2026</td>
                                                <td class="p-5"><span class="px-3 py-1 bg-blue-100 text-blue-600 rounded-full font-black text-[9px] uppercase">En cours</span></td>
                                                <td class="p-5 text-right"><button class="text-emerald-600 font-black uppercase text-[9px] hover:underline">Ouvrir</button></td>
                                            </tr>
                                            <tr>
                                                <td class="p-5 font-black">BDD-T4-2025</td>
                                                <td class="p-5 font-bold">Trimestre 4 - 2025</td>
                                                <td class="p-5"><span class="px-3 py-1 bg-green-100 text-green-600 rounded-full font-black text-[9px] uppercase">Validé</span></td>
                                                <td class="p-5 text-right"><button class="text-emerald-600 font-black uppercase text-[9px] hover:underline">Ouvrir</button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE : QUESTIONNAIRES -->
                <div id="page-questionnaires" class="hidden-section space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Vierge -->
                        <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                            <h3 class="text-xl font-black mb-6 flex items-center gap-3">
                                <div class="w-10 h-10 bg-slate-100 rounded-xl flex items-center justify-center text-slate-500"><i data-lucide="file-plus" class="w-5 h-5"></i></div>
                                Questionnaires Vierges
                            </h3>
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="space-y-2">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Année</label>
                                    <select class="w-full p-4 bg-slate-50 rounded-2xl text-xs font-bold border-none"><option>2026</option></select>
                                </div>
                                <div class="space-y-2">
                                    <label class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Trimestre</label>
                                    <select class="w-full p-4 bg-slate-50 rounded-2xl text-xs font-bold border-none"><option>T1 (Actuel)</option></select>
                                </div>
                            </div>
                            <button class="w-full bg-emerald-600 text-white py-5 rounded-3xl font-black uppercase text-xs tracking-widest hover:bg-emerald-700 shadow-lg shadow-emerald-200 transition">
                                <i data-lucide="download" class="w-4 h-4 inline mr-2"></i> Télécharger Formulaire
                            </button>
                        </div>

                        <!-- Suivi -->
                        <div id="suivi-panel" class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                            <div class="flex justify-between items-center mb-8">
                                <h3 class="text-xl font-black flex items-center gap-3">
                                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center"><i data-lucide="activity" class="w-5 h-5"></i></div>
                                    Suivi de l'Enquête
                                </h3>
                                <div id="admin1-campaign-btn" class="hidden-section">
                                    <button onclick="toggleCampaign()" id="campaign-status" class="px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all shadow-md"></button>
                                </div>
                            </div>

                            <div id="suivi-restricted" class="hidden-section flex flex-col items-center justify-center py-12 text-slate-300 italic">
                                <i data-lucide="lock" class="w-12 h-12 mb-4 opacity-20"></i>
                                <p class="text-sm font-bold">Section réservée aux Administrateurs</p>
                            </div>

                            <div id="suivi-content" class="space-y-4">
                                <!-- Contenu Admin 1 -->
                                <div id="admin1-view" class="hidden-section space-y-4">
                                    <div class="p-4 bg-slate-50 rounded-2xl border flex justify-between items-center">
                                        <div class="flex items-center gap-3">
                                            <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center shadow-sm"><i data-lucide="globe" class="text-slate-400"></i></div>
                                            <div>
                                                <p class="text-[9px] font-black text-slate-400 uppercase">Vue Nationale</p>
                                                <p class="text-lg font-black" id="total-validated">245 / 500</p>
                                            </div>
                                        </div>
                                        <select class="bg-white border rounded-lg p-2 text-[10px] font-bold outline-none">
                                            <option>Toutes régions</option>
                                            <option>Centre</option>
                                            <option>Littoral</option>
                                        </select>
                                    </div>
                                    <div class="flex gap-2">
                                        <button class="flex-1 bg-red-100 text-red-700 py-3 rounded-xl font-black text-[9px] uppercase hover:bg-red-200">Invalider Série</button>
                                        <button class="flex-1 bg-green-100 text-green-700 py-3 rounded-xl font-black text-[9px] uppercase hover:bg-green-200">Validation Finale</button>
                                    </div>
                                </div>

                                <!-- Contenu Admin 2 -->
                                <div id="admin2-view" class="hidden-section space-y-4">
                                    <div class="p-5 border-2 border-blue-100 bg-blue-50/50 rounded-2xl">
                                        <h5 class="text-[10px] font-black uppercase text-blue-600 mb-4 tracking-widest">Ma Région (Saisie Active)</h5>
                                        <div class="flex justify-between items-end">
                                            <div>
                                                <p class="text-3xl font-black">42</p>
                                                <p class="text-[10px] font-bold text-slate-400 uppercase">Questionnaires envoyés</p>
                                            </div>
                                            <button class="bg-blue-600 text-white px-5 py-2.5 rounded-xl font-black text-[9px] uppercase shadow-lg shadow-blue-200">Transmettre à l'Admin 1</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PAGE : TABLEAU DE BORD -->
                <div id="page-dashboard" class="hidden-section space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500">
                    <!-- KPI -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-emerald-500">
                            <p class="text-slate-400 text-[9px] font-black uppercase tracking-widest mb-1">Stock Total PME (2024)</p>
                            <h3 class="text-3xl font-black">443 524</h3>
                            <p class="text-emerald-500 text-[10px] font-bold mt-2 flex items-center gap-1"><i data-lucide="trending-up" class="w-3 h-3"></i> +12,8% vs 2023</p>
                        </div>
                        <div class="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-emerald-500">
                            <p class="text-slate-400 text-[9px] font-black uppercase tracking-widest mb-1">Nouvelles Créations</p>
                            <h3 class="text-3xl font-black">21 132</h3>
                            <p class="text-slate-500 text-[10px] font-bold mt-2">Record CFCE National</p>
                        </div>
                        <div class="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-emerald-500">
                            <p class="text-slate-400 text-[9px] font-black uppercase tracking-widest mb-1">OES CRÉÉES</p>
                            <h3 class="text-3xl font-black">3 909</h3>
                            <p class="text-emerald-500 text-[10px] font-bold mt-2 flex items-center gap-1"><i data-lucide="trending-up" class="w-3 h-3"></i> +10,0%</p>
                        </div>
                        <div class="bg-white p-6 rounded-3xl shadow-sm border-t-4 border-emerald-500">
                            <p class="text-slate-400 text-[9px] font-black uppercase tracking-widest mb-1">Emplois (Prévisionnels)</p>
                            <h3 class="text-3xl font-black">97 000+</h3>
                            <p class="text-purple-600 text-[10px] font-bold mt-2 uppercase tracking-tighter">Impact Social Fort</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 min-h-[400px]">
                            <h4 class="font-black text-xs uppercase mb-8 border-l-4 border-emerald-500 pl-3">Répartition du Stock par Secteur (%)</h4>
                            <div class="h-64"><canvas id="sectorChart"></canvas></div>
                        </div>
                        <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 min-h-[400px]">
                            <h4 class="font-black text-xs uppercase mb-8 border-l-4 border-blue-500 pl-3">Top Villes (Créations PME 2024)</h4>
                            <div class="h-64"><canvas id="cityChart"></canvas></div>
                        </div>
                    </div>

                    <!-- Rapport -->
                    <div class="bg-slate-900 rounded-[3rem] p-10 text-white relative overflow-hidden">
                        <i data-lucide="file-text" class="absolute -right-10 -bottom-10 w-64 h-64 opacity-5 pointer-events-none"></i>
                        <div class="relative z-10 flex flex-col md:flex-row justify-between items-center gap-8">
                            <div class="max-w-2xl">
                                <h3 class="text-3xl font-black mb-4">Rédaction de Rapport Automatique</h3>
                                <p class="text-slate-400 text-sm leading-relaxed">Le système génère une description analytique basée sur les filtres appliqués à la base de données. Téléchargez instantanément votre synthèse trimestrielle.</p>
                            </div>
                            <div class="flex flex-col gap-3 w-full md:w-auto">
                                <button onclick="simulateReport('pdf')" class="bg-emerald-500 text-slate-900 px-8 py-4 rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-emerald-400 shadow-xl shadow-emerald-500/20">Rapport PDF</button>
                                <button onclick="simulateReport('word')" class="bg-white text-slate-900 px-8 py-4 rounded-2xl font-black uppercase text-xs tracking-widest hover:bg-slate-100">Rapport Word</button>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- LOGIQUE JS -->
    <script>
        lucide.createIcons();

        let currentUser = null;
        let selectedRoleForCode = null;
        let isCampaignActive = false;

        // --- AUTHENTIFICATION ---

        function requestAccess(role) {
            selectedRoleForCode = role;
            const modal = document.getElementById('login-modal');
            const roleText = document.getElementById('modal-role-text');
            const codeInput = document.getElementById('access-code');
            const errorMsg = document.getElementById('error-msg');
            
            modal.classList.remove('hidden-section');
            roleText.innerText = role === 'admin1' ? 'Administrateur Services Centraux' : 'Chef de Service Déconcentré';
            codeInput.value = '';
            errorMsg.classList.add('hidden-section');
            codeInput.focus();
        }

        function closeModal() {
            document.getElementById('login-modal').classList.add('hidden-section');
            selectedRoleForCode = null;
        }

        function verifyCode() {
            const code = document.getElementById('access-code').value;
            const errorMsg = document.getElementById('error-msg');
            
            // CODE PAR DÉFAUT DEMANDÉ : 2026
            if (code === "2026") {
                login(selectedRoleForCode);
                closeModal();
            } else {
                errorMsg.classList.remove('hidden-section');
            }
        }

        function login(role) {
            currentUser = role;
            document.getElementById('auth-screen').classList.add('hidden-section');
            document.getElementById('app-screen').classList.remove('hidden-section');
            
            const badge = document.getElementById('role-badge');
            badge.innerText = role;
            badge.className = "px-4 py-2 rounded-xl text-[10px] font-black uppercase backdrop-blur border " + 
                             (role === 'admin1' ? 'bg-red-500/20 border-red-500/30 text-red-200' : 
                              role === 'admin2' ? 'bg-blue-500/20 border-blue-500/30 text-blue-200' : 
                                                 'bg-white/20 border-white/30 text-white');

            setupPermissions();
            navigate('dashboard'); // On commence par le dashboard comme sur les captures
        }

        function logout() {
            currentUser = null;
            document.getElementById('auth-screen').classList.remove('hidden-section');
            document.getElementById('app-screen').classList.add('hidden-section');
        }

        // --- PERMISSIONS ET NAVIGATION ---

        function setupPermissions() {
            // Reset visibility
            document.getElementById('admin1-campaign-btn').classList.add('hidden-section');
            document.getElementById('admin1-view').classList.add('hidden-section');
            document.getElementById('admin2-view').classList.add('hidden-section');
            document.getElementById('suivi-restricted').classList.add('hidden-section');
            document.getElementById('suivi-content').classList.remove('hidden-section');

            if (currentUser === 'admin1') {
                document.getElementById('admin1-campaign-btn').classList.remove('hidden-section');
                document.getElementById('admin1-view').classList.remove('hidden-section');
                updateCampaignUI();
            } else if (currentUser === 'admin2') {
                document.getElementById('admin2-view').classList.remove('hidden-section');
            } else {
                document.getElementById('suivi-restricted').classList.remove('hidden-section');
                document.getElementById('suivi-content').classList.add('hidden-section');
            }
        }

        function navigate(pageId) {
            document.querySelectorAll('main > div').forEach(div => div.classList.add('hidden-section'));
            document.getElementById('page-' + pageId).classList.remove('hidden-section');
            
            document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active-tab', 'text-emerald-600'));
            document.getElementById('nav-' + pageId).classList.add('active-tab', 'text-emerald-600');

            if (pageId === 'dashboard') initDashboardCharts();
            lucide.createIcons();
        }

        // --- GESTION CAMPAGNE ---

        function toggleCampaign() {
            isCampaignActive = !isCampaignActive;
            updateCampaignUI();
            
            const msg = isCampaignActive ? "Campagne d'enquête T1-2026 lancée avec succès." : "Campagne T1-2026 clôturée. Les données sont archivées.";
            alert(msg);
        }

        function updateCampaignUI() {
            const btn = document.getElementById('campaign-status');
            if (isCampaignActive) {
                btn.className = "px-6 py-2 rounded-xl text-[10px] font-black uppercase bg-red-500 text-white hover:bg-red-600 shadow-md";
                btn.innerText = "Arrêter Campagne";
            } else {
                btn.className = "px-6 py-2 rounded-xl text-[10px] font-black uppercase bg-emerald-500 text-white hover:bg-emerald-600 shadow-md shadow-emerald-200";
                btn.innerText = "Lancer Campagne";
            }
        }

        // --- GRAPHIQUES ---

        function initDashboardCharts() {
            // Sector Chart
            const ctxSector = document.getElementById('sectorChart').getContext('2d');
            if (window.sChart) window.sChart.destroy();
            window.sChart = new Chart(ctxSector, {
                type: 'doughnut',
                data: {
                    labels: ['Commerce', 'Industrie', 'Services', 'Artisanat', 'Social'],
                    datasets: [{
                        data: [35, 15, 45, 10, 5],
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#6366f1', '#ef4444'],
                        borderWidth: 0,
                        hoverOffset: 20
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { legend: { position: 'bottom', labels: { font: { size: 10, weight: 'bold' }, padding: 20 } } }
                }
            });

            // City Chart
            const ctxCity = document.getElementById('cityChart').getContext('2d');
            if (window.cChart) window.cChart.destroy();
            window.cChart = new Chart(ctxCity, {
                type: 'bar',
                data: {
                    labels: ['Douala', 'Yaoundé', 'Bafoussam', 'Garoua', 'Bamenda'],
                    datasets: [{
                        label: 'PME Créées',
                        data: [7800, 7200, 2400, 1800, 1500],
                        backgroundColor: '#10b981',
                        borderRadius: 12,
                        barThickness: 25
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: { display: false },
                        x: { grid: { display: false }, ticks: { font: { size: 10, weight: 'bold' } } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function simulateReport(format) {
            alert(`Génération du rapport de conjoncture au format ${format.toUpperCase()} en cours...`);
        }
    </script>
</body>
</html>
