<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conjoncture MINPMEESA - Plateforme Intégrée</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; transition: all 0.3s ease; }
        .hidden-section { display: none !important; }
        .nav-active { border-bottom: 4px solid #10b981; color: #10b981 !important; }
        .bg-conjoncture { background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); }
        .campaign-active { border: 2px solid #10b981; position: relative; }
        .campaign-active::after { content: "CAMPAGNE EN COURS"; position: absolute; top: -10px; right: 10px; background: #10b981; color: white; font-size: 8px; font-weight: bold; padding: 2px 8px; border-radius: 9999px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <!-- 1ère INTERFACE : ACCUEIL ET AUTHENTIFICATION -->
    <div id="interface-1" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-100 p-4">
        <!-- Fond avec Nom de la plateforme -->
        <div class="absolute inset-0 opacity-5 flex items-center justify-center pointer-events-none select-none overflow-hidden">
            <h1 class="text-[12vw] font-black uppercase text-slate-900 leading-none text-center">CONJONCTURE<br>MINPMEESA</h1>
        </div>

        <div class="relative bg-white/90 backdrop-blur-md p-8 md:p-12 rounded-[3rem] shadow-2xl w-full max-w-4xl flex flex-col items-center border border-white">
            <!-- Logo Ministère -->
            <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 border-4 border-emerald-500 shadow-xl p-2 overflow-hidden">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Coat_of_arms_of_Cameroon.svg/600px-Coat_of_arms_of_Cameroon.svg.png" alt="Logo Ministère" class="object-contain h-full">
            </div>
            
            <h1 class="text-3xl md:text-4xl font-black text-slate-800 tracking-tighter text-center uppercase mb-2">CONJONCTURE MINPMEESA</h1>
            <p class="text-slate-500 font-medium mb-10">Système d'Information Statistique National</p>

            <!-- Traduction -->
            <div class="flex gap-2 mb-12 bg-slate-200 p-1 rounded-full text-[10px] font-black tracking-widest">
                <button class="bg-white px-6 py-2 rounded-full shadow-sm text-emerald-600">FRANÇAIS</button>
                <button class="px-6 py-2 rounded-full hover:bg-white transition text-slate-400">ENGLISH</button>
            </div>

            <!-- Boutons d'accès -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 w-full">
                <button onclick="askCode('admin1')" class="group p-8 border-2 border-slate-100 rounded-[2rem] hover:border-emerald-500 hover:shadow-xl transition-all flex flex-col items-center text-center bg-white">
                    <div class="w-14 h-14 bg-red-50 text-red-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition border border-red-100">
                        <i data-lucide="shield-check" class="w-8 h-8"></i>
                    </div>
                    <span class="font-bold text-slate-700">Service Central</span>
                    <span class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">(ADMIN 1)</span>
                </button>

                <button onclick="askCode('admin2')" class="group p-8 border-2 border-slate-100 rounded-[2rem] hover:border-emerald-500 hover:shadow-xl transition-all flex flex-col items-center text-center bg-white">
                    <div class="w-14 h-14 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition border border-blue-100">
                        <i data-lucide="map-pin" class="w-8 h-8"></i>
                    </div>
                    <span class="font-bold text-slate-700">Services Déconcentrés</span>
                    <span class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">(ADMIN 2)</span>
                </button>

                <button onclick="login('visiteur')" class="group p-8 border-2 border-slate-100 rounded-[2rem] hover:border-emerald-500 hover:shadow-xl transition-all flex flex-col items-center text-center bg-white">
                    <div class="w-14 h-14 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition border border-emerald-100">
                        <i data-lucide="users" class="w-8 h-8"></i>
                    </div>
                    <span class="font-bold text-slate-700">Visiteurs</span>
                    <span class="text-[10px] text-slate-400 mt-2 uppercase tracking-widest font-bold">(ACCÈS LIBRE)</span>
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL CODE D'ACCÈS -->
    <div id="modal-code" class="fixed inset-0 z-[60] flex items-center justify-center bg-slate-900/90 backdrop-blur-sm hidden-section p-4">
        <div class="bg-white p-10 rounded-[2.5rem] shadow-2xl w-full max-w-sm text-center">
            <div class="w-16 h-16 bg-slate-100 rounded-2xl flex items-center justify-center mx-auto mb-6 text-slate-400">
                <i data-lucide="lock" class="w-8 h-8"></i>
            </div>
            <h3 class="text-xl font-bold mb-2">Code d'accès requis</h3>
            <p id="label-admin" class="text-[10px] text-slate-400 mb-8 uppercase font-black tracking-widest"></p>
            
            <input type="password" id="input-code" placeholder="Entrez le code" class="w-full p-4 bg-slate-50 border-2 border-slate-100 rounded-2xl mb-4 text-center text-3xl font-black tracking-[0.5em] focus:border-emerald-500 outline-none transition uppercase">
            
            <div id="error-code" class="text-red-500 text-[10px] font-black uppercase mb-4 hidden-section">Code incorrect. Veuillez réessayer.</div>

            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 py-3 font-bold text-slate-400 hover:text-slate-600 transition">ANNULER</button>
                <button onclick="verifyCode()" class="flex-1 bg-slate-900 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg">VALIDER</button>
            </div>
        </div>
    </div>

    <!-- 2ème INTERFACE : NAV & CONTENU -->
    <div id="interface-2" class="hidden-section min-h-screen flex flex-col">
        <!-- BARRE DE MENU SUPÉRIEURE -->
        <header class="bg-white border-b px-8 py-6 sticky top-0 z-40 shadow-sm flex flex-col md:flex-row justify-between items-center gap-6">
            <div class="flex items-center gap-4">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/6f/Coat_of_arms_of_Cameroon.svg/600px-Coat_of_arms_of_Cameroon.svg.png" class="h-10 w-auto" alt="Logo">
                <div class="h-8 w-[2px] bg-slate-200 mx-1"></div>
                <h2 class="font-black text-slate-800 tracking-tighter text-lg uppercase">Conjoncture</h2>
            </div>

            <nav id="main-nav" class="flex gap-8 font-black text-[10px] uppercase tracking-widest text-slate-400">
                <button onclick="showPage('bdd')" id="nav-bdd" class="py-2 hover:text-emerald-600 transition border-b-4 border-transparent">Base de données</button>
                <button onclick="showPage('questionnaires')" id="nav-questionnaires" class="py-2 hover:text-emerald-600 transition border-b-4 border-transparent">Questionnaires</button>
                <button onclick="showPage('dashboard')" id="nav-dashboard" class="py-2 hover:text-emerald-600 transition border-b-4 border-transparent">Tableau de Bord</button>
            </nav>

            <div class="flex items-center gap-4">
                <div id="role-tag" class="px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-tighter"></div>
                <button onclick="window.location.reload()" class="p-2 text-slate-400 hover:text-red-500 transition"><i data-lucide="log-out" class="w-5 h-5"></i></button>
            </div>
        </header>

        <main class="flex-1 p-6 md:p-10 max-w-7xl mx-auto w-full">
            
            <!-- PAGE : BASE DE DONNÉES -->
            <div id="page-bdd" class="hidden-section space-y-10 animate-in fade-in duration-500">
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <!-- Sidebar Filtres -->
                    <div class="lg:col-span-1 bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-8">
                        <h3 class="font-black text-xs uppercase tracking-widest flex items-center gap-2"><i data-lucide="filter" class="w-4 h-4 text-emerald-600"></i> Filtres</h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Année(s)</label>
                                <div class="grid grid-cols-2 gap-2 mt-2">
                                    <button class="year-btn bg-slate-100 p-2 rounded-xl text-[10px] font-bold hover:bg-emerald-500 hover:text-white transition">2021-25</button>
                                    <button class="year-btn bg-emerald-500 text-white p-2 rounded-xl text-[10px] font-bold transition">2026</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Trimestre(s)</label>
                                <div class="flex flex-wrap gap-2 mt-2">
                                    <button class="q-btn bg-emerald-500 text-white px-3 py-1.5 rounded-lg text-[9px] font-bold">T1</button>
                                    <button class="q-btn bg-slate-100 px-3 py-1.5 rounded-lg text-[9px] font-bold">T2</button>
                                    <button class="q-btn bg-slate-100 px-3 py-1.5 rounded-lg text-[9px] font-bold">T3</button>
                                    <button class="q-btn bg-slate-100 px-3 py-1.5 rounded-lg text-[9px] font-bold">T4</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Région(s)</label>
                                <select class="w-full mt-2 p-3 bg-slate-50 rounded-xl text-[10px] font-bold outline-none border-none">
                                    <option>Toutes les régions</option>
                                    <option>Littoral</option>
                                    <option>Centre</option>
                                </select>
                            </div>
                        </div>
                        <button class="w-full bg-slate-900 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest flex items-center justify-center gap-2 shadow-lg">
                            <i data-lucide="download" class="w-4 h-4"></i> Télécharger
                        </button>
                    </div>

                    <!-- Contenu Bases -->
                    <div class="lg:col-span-3 space-y-8">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border-2 border-amber-100 hover:border-amber-300 transition-all cursor-pointer">
                                <i data-lucide="archive" class="w-10 h-10 text-amber-600 mb-4"></i>
                                <h4 class="font-black text-lg">Archives 2021-2025</h4>
                                <p class="text-xs text-slate-400 mt-2">Accès aux anciennes bases de données de la structure.</p>
                            </div>
                            <div class="bg-white p-8 rounded-[2.5rem] shadow-sm border-2 border-emerald-100 hover:border-emerald-300 transition-all cursor-pointer">
                                <i data-lucide="database" class="w-10 h-10 text-emerald-600 mb-4"></i>
                                <h4 class="font-black text-lg">Bases 2026+ (Flux Bruts)</h4>
                                <p class="text-xs text-slate-400 mt-2">Lieu de stockage des nouvelles bases formulées et validées.</p>
                            </div>
                        </div>

                        <div class="bg-white rounded-[2.5rem] border overflow-hidden shadow-sm">
                            <div class="p-8 border-b bg-slate-50 flex justify-between items-center">
                                <h4 class="font-black text-xs uppercase tracking-widest">Visualisation de la Base de Données</h4>
                                <span class="bg-emerald-100 text-emerald-700 px-4 py-1.5 rounded-full text-[9px] font-black uppercase">Statut : Validé</span>
                            </div>
                            <div class="p-8 min-h-[300px] flex flex-col items-center justify-center text-center">
                                <i data-lucide="table" class="w-16 h-16 text-slate-200 mb-4"></i>
                                <p class="text-xs text-slate-400 font-medium">Sélectionnez des filtres pour visualiser les données ici.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PAGE : QUESTIONNAIRES -->
            <div id="page-questionnaires" class="hidden-section space-y-10 animate-in fade-in duration-500">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Entrée 1 : Téléchargement vierges -->
                    <div class="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100 space-y-8">
                        <div class="flex items-center gap-4">
                            <div class="w-14 h-14 bg-slate-100 rounded-2xl flex items-center justify-center text-slate-500 shadow-sm"><i data-lucide="file-down"></i></div>
                            <div>
                                <h3 class="text-xl font-black text-slate-800">Formulaires Vierges</h3>
                                <p class="text-[10px] text-slate-400 uppercase font-black tracking-widest">Télécharger les questionnaires validés</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Année</label>
                                <select class="w-full p-4 bg-slate-50 rounded-2xl text-[10px] font-black outline-none border-none"><option>2026</option><option>2025</option></select>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Trimestre</label>
                                <select class="w-full p-4 bg-slate-50 rounded-2xl text-[10px] font-black outline-none border-none"><option>T1 (Jan-Mar)</option><option>T2</option></select>
                            </div>
                        </div>
                        <button class="w-full bg-emerald-600 text-white py-5 rounded-[2rem] font-black uppercase text-xs tracking-widest hover:bg-emerald-700 shadow-xl transition shadow-emerald-200 flex items-center justify-center gap-3">
                            <i data-lucide="download" class="w-5 h-5"></i> Télécharger Formulaire
                        </button>
                    </div>

                    <!-- Entrée 2 : Suivi enquête -->
                    <div id="section-suivi" class="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100 space-y-8 relative overflow-hidden">
                        <!-- Lock Visiteur -->
                        <div id="lock-visiteur" class="hidden-section absolute inset-0 z-10 bg-white/90 backdrop-blur-md flex flex-col items-center justify-center text-center p-8">
                            <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-6 text-slate-300"><i data-lucide="lock" class="w-8 h-8"></i></div>
                            <h4 class="font-black text-lg text-slate-800 uppercase tracking-tighter">Accès Réservé Admins</h4>
                            <p class="text-xs text-slate-400 mt-2 max-w-xs">Le suivi en temps réel et la validation sont réservés aux Services Centraux et Déconcentrés.</p>
                        </div>

                        <div class="flex justify-between items-center">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 bg-emerald-50 text-emerald-600 rounded-2xl flex items-center justify-center shadow-sm border border-emerald-100"><i data-lucide="activity"></i></div>
                                <div>
                                    <h3 class="text-xl font-black text-slate-800 uppercase tracking-tighter">Suivi Enquête</h3>
                                    <p class="text-[10px] text-slate-400 font-black tracking-widest uppercase">Évolution de la collecte active</p>
                                </div>
                            </div>
                            <!-- Bouton Campagne Admin 1 -->
                            <div id="admin1-controls" class="hidden-section">
                                <button onclick="toggleCampaign()" id="campaign-btn" class="px-6 py-2.5 rounded-2xl text-[9px] font-black uppercase tracking-widest shadow-xl transition-all"></button>
                            </div>
                        </div>

                        <!-- Filtre Région pour Admin 1 -->
                        <div id="admin1-filter-region" class="hidden-section p-4 bg-slate-50 rounded-2xl">
                            <label class="text-[8px] font-black text-slate-400 uppercase tracking-widest">Filtre Régional (Admin 1)</label>
                            <select class="w-full mt-2 bg-white p-3 rounded-xl text-[10px] font-bold outline-none border-none"><option>Toutes les régions</option><option>Littoral</option><option>Centre</option></select>
                        </div>

                        <!-- Boîte Réception Formulaire Admin 2 -->
                        <div id="admin2-form-box" class="hidden-section p-6 border-2 border-dashed border-emerald-200 rounded-[2rem] bg-emerald-50/30 text-center">
                            <div id="form-available" class="space-y-4">
                                <h4 class="text-xs font-black text-emerald-800 uppercase">Nouvelle enquête T1-2026 lancée</h4>
                                <button class="bg-emerald-600 text-white px-8 py-3 rounded-xl font-black text-[10px] uppercase tracking-widest">Accéder au Formulaire</button>
                            </div>
                            <div id="form-empty" class="hidden-section py-4">
                                <p class="text-xs text-slate-400 font-bold uppercase italic tracking-tighter">Aucune campagne lancée par le Central.</p>
                            </div>
                        </div>

                        <div class="space-y-4" id="suivi-list">
                            <div class="p-6 bg-slate-50 rounded-[2rem] border flex justify-between items-center">
                                <div>
                                    <p class="text-[9px] font-black text-slate-400 uppercase tracking-widest">Validés par Chef de Service</p>
                                    <p class="text-3xl font-black">128</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="alert('Visualisation du contenu...')" class="bg-white border px-4 py-2 rounded-xl text-[9px] font-black uppercase hover:bg-slate-100 transition shadow-sm">Vérifier Contenu</button>
                                </div>
                            </div>

                            <!-- Actions Admin 1 -->
                            <div id="admin1-actions" class="hidden-section flex gap-2">
                                <button class="flex-1 bg-red-100 text-red-700 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-red-200 transition">Invalider & Renvoyer</button>
                                <button class="flex-1 bg-emerald-600 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-emerald-700 transition shadow-lg shadow-emerald-200">Valider Dossier</button>
                            </div>

                            <!-- Actions Admin 2 -->
                            <div id="admin2-actions" class="hidden-section flex gap-2">
                                <button class="flex-1 bg-red-100 text-red-700 py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest">Invalider Enquêteur</button>
                                <button class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-lg shadow-blue-200">Envoyer à l'Admin 1</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Interface Kobo (Simulation) -->
                <div id="kobo-section" class="bg-white p-4 rounded-[3.5rem] shadow-xl border border-slate-100">
                    <div class="p-6 flex justify-between items-center">
                        <h3 class="font-black uppercase text-[10px] tracking-widest text-emerald-800">Intégration Questionnaire Numérique T1-2026</h3>
                        <button onclick="window.open('https://ee.kobotoolbox.org/x/5OfrrL9k', '_blank')" class="bg-slate-900 text-white px-6 py-2 rounded-xl text-[9px] font-black uppercase tracking-widest">Ouvrir Plein Écran</button>
                    </div>
                    <iframe src="https://ee.kobotoolbox.org/x/5OfrrL9k" class="w-full h-[600px] rounded-[2.5rem] border-none shadow-inner bg-slate-50" title="Questionnaire PMEESA"></iframe>
                </div>
            </div>

            <!-- PAGE : TABLEAU DE BORD -->
            <div id="page-dashboard" class="hidden-section space-y-10 animate-in fade-in duration-500">
                <!-- Filtres Dashboard -->
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100">
                    <div>
                        <h3 class="font-black text-lg text-slate-800">Analyse Conjoncturelle</h3>
                        <p class="text-[10px] text-slate-400 font-black uppercase tracking-widest mt-1">Source : BDD-T1-2026 (Nouveau Flux)</p>
                    </div>
                    <div class="flex flex-wrap gap-4">
                        <select class="bg-slate-100 p-3 rounded-xl text-[10px] font-black outline-none"><option>Année : 2026</option></select>
                        <select class="bg-slate-100 p-3 rounded-xl text-[10px] font-black outline-none"><option>Trimestre : T1</option></select>
                        <select class="bg-slate-100 p-3 rounded-xl text-[10px] font-black outline-none"><option>Région : Toutes</option></select>
                        <button onclick="generateReport()" class="bg-slate-900 text-white px-6 py-3 rounded-2xl font-black text-[10px] uppercase tracking-widest hover:bg-emerald-600 transition shadow-lg">
                            <i data-lucide="file-text" class="w-4 h-4 inline mr-2"></i> Rapport Auto
                        </button>
                    </div>
                </div>

                <!-- Graphiques -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100 h-[450px] flex flex-col">
                        <h4 class="font-black text-xs uppercase mb-10 border-l-8 border-emerald-500 pl-4 tracking-widest">Indice de Confiance Trimestriel</h4>
                        <div class="flex-1"><canvas id="chart-line"></canvas></div>
                    </div>
                    <div class="bg-white p-10 rounded-[3rem] shadow-sm border border-slate-100 h-[450px] flex flex-col">
                        <h4 class="font-black text-xs uppercase mb-10 border-l-8 border-blue-500 pl-4 tracking-widest">Répartition Sectorielle (Stock PME)</h4>
                        <div class="flex-1"><canvas id="chart-pie"></canvas></div>
                    </div>
                </div>

                <!-- Simulation Rapport -->
                <div id="report-view" class="hidden-section bg-slate-900 p-12 rounded-[4rem] text-white relative overflow-hidden animate-in zoom-in duration-300 shadow-2xl">
                    <div class="absolute inset-0 opacity-5"><i data-lucide="file-text" class="w-96 h-96 -right-10 -bottom-10 absolute"></i></div>
                    <div class="max-w-3xl mx-auto bg-white p-12 md:p-20 shadow-2xl border text-slate-800 rounded shadow-emerald-500/20">
                        <div class="text-center mb-12">
                            <p class="uppercase font-black text-[10px] tracking-[0.3em] text-slate-400 mb-4">République du Cameroun</p>
                            <h2 class="text-2xl font-black underline mb-2 tracking-tighter">RAPPORT ANALYTIQUE DE CONJONCTURE</h2>
                            <p class="font-black text-emerald-600 uppercase text-[10px] tracking-widest">Période : T1 - 2026</p>
                        </div>
                        <div class="space-y-8 text-sm leading-relaxed text-justify">
                            <p class="italic font-bold text-slate-400 text-xs">Description des données issues de la base BDD-T1-2026 :</p>
                            <p>Les indicateurs sectoriels compilés au premier trimestre 2026 montrent une résilience notable de l'écosystème entrepreneurial. Le stock total des PME enregistre une progression constante, particulièrement dans les régions déconcentrées du Littoral et du Centre.</p>
                            <p>L'indice de confiance affiche une stabilité structurelle. Cependant, on note un besoin de renforcement des mécanismes de financement pour les structures artisanales en milieu rural.</p>
                        </div>
                        <div class="mt-20 pt-10 border-t flex justify-between items-center text-[10px] font-black uppercase text-slate-400">
                            <span>Plateforme Conjoncture</span>
                            <div class="flex gap-4">
                                <button class="text-emerald-600 underline">Télécharger PDF</button>
                                <button class="text-blue-600 underline">Télécharger WORD</button>
                            </div>
                        </div>
                    </div>
                    <button onclick="document.getElementById('report-view').classList.add('hidden-section')" class="absolute top-10 right-10 text-white/50 hover:text-white"><i data-lucide="x-circle" class="w-8 h-8"></i></button>
                </div>
            </div>

        </main>
    </div>

    <script>
        lucide.createIcons();

        let currentRole = null;
        let isCampaignActive = false;
        let loginTarget = null;

        // --- AUTHENTIFICATION ---

        function askCode(role) {
            loginTarget = role;
            document.getElementById('modal-code').classList.remove('hidden-section');
            document.getElementById('label-admin').innerText = (role === 'admin1') ? "Service Central du Ministère" : "Chef de Services Déconcentrés";
            document.getElementById('input-code').value = '';
            document.getElementById('error-code').classList.add('hidden-section');
            document.getElementById('input-code').focus();
        }

        function closeModal() {
            document.getElementById('modal-code').classList.add('hidden-section');
        }

        function verifyCode() {
            const code = document.getElementById('input-code').value;
            if (code === "2026") {
                login(loginTarget);
                closeModal();
            } else {
                document.getElementById('error-code').classList.remove('hidden-section');
            }
        }

        function login(role) {
            currentRole = role;
            document.getElementById('interface-1').classList.add('hidden-section');
            document.getElementById('interface-2').classList.remove('hidden-section');
            
            const badge = document.getElementById('role-tag');
            badge.innerText = role === 'admin1' ? "ADMIN 1" : role === 'admin2' ? "ADMIN 2" : "VISITEUR";
            badge.className = "px-4 py-1.5 rounded-full text-[9px] font-black uppercase tracking-tighter " + 
                             (role === 'admin1' ? 'bg-red-500 text-white' : role === 'admin2' ? 'bg-blue-600 text-white' : 'bg-emerald-500 text-white');

            applyPermissions();
            showPage('dashboard');
        }

        // --- GESTION DES PAGES ET DROITS ---

        function showPage(pageId) {
            document.querySelectorAll('main > div').forEach(p => p.classList.add('hidden-section'));
            document.getElementById('page-' + pageId).classList.remove('hidden-section');
            
            document.querySelectorAll('#main-nav button').forEach(b => b.classList.remove('nav-active'));
            document.getElementById('nav-' + pageId).classList.add('nav-active');

            if (pageId === 'dashboard') initCharts();
            lucide.createIcons();
        }

        function applyPermissions() {
            // Reset
            document.getElementById('lock-visiteur').classList.add('hidden-section');
            document.getElementById('admin1-controls').classList.add('hidden-section');
            document.getElementById('admin1-filter-region').classList.add('hidden-section');
            document.getElementById('admin1-actions').classList.add('hidden-section');
            document.getElementById('admin2-form-box').classList.add('hidden-section');
            document.getElementById('admin2-actions').classList.add('hidden-section');
            document.getElementById('kobo-section').classList.add('hidden-section');

            if (currentRole === 'visiteur') {
                document.getElementById('lock-visiteur').classList.remove('hidden-section');
            } else if (currentRole === 'admin1') {
                document.getElementById('admin1-controls').classList.remove('hidden-section');
                document.getElementById('admin1-filter-region').classList.remove('hidden-section');
                document.getElementById('admin1-actions').classList.remove('hidden-section');
                updateCampaignBtn();
            } else if (currentRole === 'admin2') {
                document.getElementById('admin2-form-box').classList.remove('hidden-section');
                document.getElementById('admin2-actions').classList.remove('hidden-section');
                if (isCampaignActive) {
                    document.getElementById('form-available').classList.remove('hidden-section');
                    document.getElementById('form-empty').classList.add('hidden-section');
                    document.getElementById('kobo-section').classList.remove('hidden-section');
                } else {
                    document.getElementById('form-available').classList.add('hidden-section');
                    document.getElementById('form-empty').classList.remove('hidden-section');
                }
            }
        }

        // --- GESTION CAMPAGNE ---

        function toggleCampaign() {
            isCampaignActive = !isCampaignActive;
            updateCampaignBtn();
            
            if (isCampaignActive) {
                alert("CAMPAGNE LANCÉE : Les enquêtes peuvent débuter. Les chefs de services statistiques peuvent accéder au formulaire.");
            } else {
                alert("CAMPAGNE ARRÊTÉE : Le questionnaire actif est écrasé et archivé. La base de données est mise à jour sous BDD-T1-2026.");
            }
            applyPermissions(); // Refresh UI roles
        }

        function updateCampaignBtn() {
            const btn = document.getElementById('campaign-btn');
            if (isCampaignActive) {
                btn.innerText = "Arrêter Campagne";
                btn.className = "px-6 py-2.5 rounded-2xl text-[9px] font-black uppercase tracking-widest shadow-xl bg-red-500 text-white hover:bg-red-600";
            } else {
                btn.innerText = "Lancer Campagne";
                btn.className = "px-6 py-2.5 rounded-2xl text-[9px] font-black uppercase tracking-widest shadow-xl bg-emerald-500 text-white hover:bg-emerald-600";
            }
        }

        // --- TABLEAU DE BORD & CHARTS ---

        function initCharts() {
            // Line Chart
            const ctxL = document.getElementById('chart-line').getContext('2d');
            if (window.myLineChart) window.myLineChart.destroy();
            window.myLineChart = new Chart(ctxL, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Avr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Indice Conjoncture',
                        data: [65, 59, 80, 81, 56, 95],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });

            // Pie Chart
            const ctxP = document.getElementById('chart-pie').getContext('2d');
            if (window.myPieChart) window.myPieChart.destroy();
            window.myPieChart = new Chart(ctxP, {
                type: 'doughnut',
                data: {
                    labels: ['Commerce', 'Industrie', 'Services', 'Social'],
                    datasets: [{
                        data: [35, 15, 45, 5],
                        backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444'],
                        borderWidth: 0
                    }]
                },
                options: { maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { font: { size: 10, weight: 'bold' }, padding: 20 } } } }
            });
        }

        function generateReport() {
            document.getElementById('report-view').classList.remove('hidden-section');
            document.getElementById('report-view').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
